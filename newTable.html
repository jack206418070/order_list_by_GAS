<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./sass/main.css" class="css">
  <link rel="stylesheet" href="./table.css" class="css">
  <title>Document</title>
</head>

<body>
  <div id="app">
    <div class="container">
      <div class="row">
        <template v-for="(item, index) in orderList" :key="index">
          <div v-if="item !== undefined" class="col-12 noBreak print-page" :class="`list-table${index + 1}`" style="page-break-after:always">
            <div style="display:flex; align-items:center; justify-content:center">
              <h1 style="text-align: center; font-size:36px;">{{ item?.id }}</h1>
              <p v-if="item?.method !== '銀行轉帳' " style="font-size:36px; margin-left:30px">V</p>
            </div>
            <table>
              <tr>
                <td>訂貨人</td>
                <td colspan="3">{{ item?.name }}</td>
              </tr>
              <tr>
                <td>連絡電話</td>
                <td colspan="3">{{ item?.phone }}</td>
              </tr>
              <tr>
                <td>付款方式</td>
                <td colspan="3">{{ item?.method }}</td>
              </tr>
              <tr>
                <td>地址</td>
                <td colspan="3">{{ item?.address }}</td>
              </tr>
              <tr>
                <td>備註</td>
                <td colspan="3">{{ item?.extra }}</td>
              </tr>
              <tr>
                <td>優惠項目</td>
                <td colspan="3"></td>
              </tr>
              <tr>
                <td colspan="4"></td>
              </tr>
              <tr>
                <td>品項</td>
                <td>數量</td>
                <td>單價</td>
                <td>金額</td>
              </tr>
              <tr v-for="(order, index) in item?.order_product" :key="100+index">
                <template v-if="index < 24">
                  <td class="title" style="padding:7px 0">{{ order?.name !== undefined ? order.name : order }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.qty !== undefined ? order.qty : '' }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.price !== undefined ? order.price : '' }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.total !== undefined ? order.total : '' }}</td>
                </template>
              </tr>
              <tr v-if="item?.order_product.length < 24">
                <td>總金額</td>
                <td colspan="3">{{ item?.total }}</td>
              </tr>
            </table>
          </div>
          <div v-if="item !== undefined" class="col-12 noBreak print-page" :class="`list-table${index + 1}`" style="page-break-after:always">
            <div style="display:flex; align-items:center; justify-content:center">
              <h1 style="text-align: center; font-size:36px;">{{ item?.id }}</h1>
              <p v-if="item?.method !== '銀行轉帳' " style="font-size:36px; margin-left:30px">V</p>
            </div>
            <table>
              <tr>
                <td>訂貨人</td>
                <td colspan="3">{{ item?.name }}</td>
              </tr>
              <tr>
                <td>連絡電話</td>
                <td colspan="3">{{ item?.phone }}</td>
              </tr>
              <tr>
                <td>付款方式</td>
                <td colspan="3">{{ item?.method }}</td>
              </tr>
              <tr>
                <td>地址</td>
                <td colspan="3">{{ item?.address }}</td>
              </tr>
              <tr>
                <td>備註</td>
                <td colspan="3">{{ item?.extra }}</td>
              </tr>
              <tr>
                <td>優惠項目</td>
                <td colspan="3"></td>
              </tr>
              <tr>
                <td colspan="4"></td>
              </tr>
              <tr>
                <td>品項</td>
                <td>數量</td>
                <td>單價</td>
                <td>金額</td>
              </tr>
              <tr v-for="(order, index) in item?.order_product" :key="100+index">
                <template v-if="index < 24">
                  <td class="title" style="padding:7px 0">{{ order?.name !== undefined ? order.name : order }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.qty !== undefined ? order.qty : '' }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.price !== undefined ? order.price : '' }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.total !== undefined ? order.total : '' }}</td>
                </template>
              </tr>
              <tr v-if="item?.order_product.length < 24">
                <td>總金額</td>
                <td colspan="3">{{ item?.total }}</td>
              </tr>
            </table>
          </div>
          <div v-if="item !== undefined && item?.order_product.length > 23" class="col-12 noBreak print-page" :class="`list-table${index + 1}`" style="page-break-after:always">
            <div style="display:flex; align-items:center; justify-content:center">
              <h1 style="text-align: center; font-size:36px;">{{ item?.id }}</h1>
              <p v-if="item?.method !== '銀行轉帳' " style="font-size:36px; margin-left:30px">V</p>
            </div>
            <table>
              <tr>
                <td>訂貨人</td>
                <td colspan="3">{{ item?.name }}</td>
              </tr>
              <tr>
                <td>連絡電話</td>
                <td colspan="3">{{ item?.phone }}</td>
              </tr>
              <tr>
                <td>付款方式</td>
                <td colspan="3">{{ item?.method }}</td>
              </tr>
              <tr>
                <td>地址</td>
                <td colspan="3">{{ item?.address }}</td>
              </tr>
              <tr>
                <td>備註</td>
                <td colspan="3">{{ item?.extra }}</td>
              </tr>
              <tr>
                <td>優惠項目</td>
                <td colspan="3"></td>
              </tr>
              <tr>
                <td colspan="4"></td>
              </tr>
              <tr>
                <td>品項</td>
                <td>數量</td>
                <td>單價</td>
                <td>金額</td>
              </tr>
              <tr v-for="(order, index) in item?.order_product" :key="100+index">
                <template v-if="index >= 24">
                  <td class="title" style="padding:7px 0">{{ order?.name !== undefined ? order.name : order }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.qty !== undefined ? order.qty : '' }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.price !== undefined ? order.price : '' }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.total !== undefined ? order.total : '' }}</td>
                </template>
              </tr>
              <tr>
                <td>總金額</td>
                <td colspan="3">{{ item?.total }}</td>
              </tr>
            </table>
          </div>
          <div v-if="item !== undefined && item?.order_product.length > 23" class="col-12 noBreak print-page" :class="`list-table${index + 1}`" style="page-break-after:always">
            <div style="display:flex; align-items:center; justify-content:center">
              <h1 style="text-align: center; font-size:36px;">{{ item?.id }}</h1>
              <p v-if="item?.method !== '銀行轉帳' " style="font-size:36px; margin-left:30px">V</p>
            </div>
            <table>
              <tr>
                <td>訂貨人</td>
                <td colspan="3">{{ item?.name }}</td>
              </tr>
              <tr>
                <td>連絡電話</td>
                <td colspan="3">{{ item?.phone }}</td>
              </tr>
              <tr>
                <td>付款方式</td>
                <td colspan="3">{{ item?.method }}</td>
              </tr>
              <tr>
                <td>地址</td>
                <td colspan="3">{{ item?.address }}</td>
              </tr>
              <tr>
                <td>備註</td>
                <td colspan="3">{{ item?.extra }}</td>
              </tr>
              <tr>
                <td>優惠項目</td>
                <td colspan="3"></td>
              </tr>
              <tr>
                <td colspan="4"></td>
              </tr>
              <tr>
                <td>品項</td>
                <td>數量</td>
                <td>單價</td>
                <td>金額</td>
              </tr>
              <tr v-for="(order, index) in item?.order_product" :key="100+index">
                <template v-if="index >= 24">
                  <td class="title" style="padding:7px 0">{{ order?.name !== undefined ? order.name : order }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.qty !== undefined ? order.qty : '' }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.price !== undefined ? order.price : '' }}</td>
                  <td class="list" style="padding:7px 0">{{ order?.total !== undefined ? order.total : '' }}</td>
                </template>
              </tr>
              <tr>
                <td>總金額</td>
                <td colspan="3">{{ item?.total }}</td>
              </tr>
            </table>
          </div>
        </template>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/vue@3"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
  <script src="//code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
    crossorigin="anonymous"></script>
  <!-- <script src="./js/newTable.js"></script> -->
  <script>
    const app = Vue.createApp({
      data() {
        return {
          orderList: []
        }
      },
      methods: {
        format_date (time) {
          const localDate = new Date(time * 1000)
          return localDate.toLocaleDateString()
        },
        async getOrders() {
          try {
            let date = new Date();
            const res = await axios('http://18.179.38.237/v2/api/ginjack/admin/orders/table')
            console.log(res.data.orders)
            res.data.orders.forEach(order => {
              let order_product = []
              order.products.forEach(item => {
                let temp_data = {
                  name: item.product.title,
                  qty: item.qty,
                  price: item.product.price,
                  total: item.total
                }
                order_product.push(temp_data)
              })
              let temp_order_data = {
                name: order.user.name,
                phone: order.user.tel,
                address: order.user.address_str,
                method: order.is_cash ? '現金支付' : '轉帳',
                extra: order.message,
                order_product: order_product,
                total: order.total
              }
              this.orderList.push(temp_order_data)
            })
            console.log(this.orderList)
          } catch (err) {
            console.dir(err)
          }
        }
      },
      created() {
        this.getOrders()
      }
    })
    app.mount('#app')
  </script>
</body>

</html>